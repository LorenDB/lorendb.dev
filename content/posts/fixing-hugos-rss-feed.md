+++
title = "Fixing Hugo's RSS Feed"
date = 2024-02-19T23:15:00-05:00
tags = ["blog", "hugo", "rss"]
+++

I've built this blog using [Hugo](https://gohugo.io), which I love for its sheer simplicity. However, I noticed that the autogenerated [RSS feed](https://lorendb.dev/index.xml)
wasn't showing any author information. It turns out that I copy-pasted an outdated `hugo.toml` template that used an older method of specifying author information. This led to
the following changes in my `hugo.toml`:

``` toml
[params]
  # before
  author = "Loren Burkholder"
  
  # after
  author.name = "Loren Burkholder"
  author.link = "https://lorendb.dev"
  author.email = "computersemiexpert@outlook.com"
```

However, the feed still had some problems. The author for each post was formatted as `computersemiexpert@outlook.com (Loren Burkholder)`, which is pointlessly verbose. Furthermore,
while I try to add tags to each post I make, Hugo was blissfully ignoring them in the RSS feed.

The author name formatting was fairly easy to fix; I just needed to copy the [default RSS template](https://github.com/gohugoio/hugo/blob/master/tpl/tplimpl/embedded/templates/_default/rss.xml)
to `layouts/_default/rss.xml` and change the author field from this:

``` xml
{{- with $authorEmail }}<author>{{ . }}{{ with $authorName }} ({{ . }}){{ end }}</author>{{ end }}
```

to this:

``` xml
{{- with $authorName }}<dc:creator>{{ . }}</dc:creator>{{ end }}
```

This will render each post with the author set to `Loren Burkholder`. Much better! You will note that I changed the `<author>` tag to `<dc:creator>`. This is because the
RSS spec [requires](https://www.rssboard.org/rss-profile#element-channel-item-author) the `<author>` tag to use the `me@example.com (My Name)` format. `<dc:creator>`, however,
allows you to use just a name without violating the spec. Unfortunately, it looks like [Akregator](https://apps.kde.org/akregator/) can't handle a feed without `<author>`,
and [Tiny Tiny RSS](https://tt-rss.org) doesn't observe the `<dc:creator>` field, so I had to put back the original author field as well.

The tags were slightly trickier. Since I'm a total Hugo scripting noob, I ended up copying a [general tag rendering snippet](https://discourse.gohugo.io/t/loop-through-categories-tags/20317/2)
from the Hugo forums and adapting it to my RSS template:

``` xml
{{ if isset .Params "tags" -}}
    {{ range $index, $name := sort .Params.tags -}}
    <category>{{ $name }}</category>
    {{- end}}
{{- end }} 
```

You can find my entire RSS template [here](https://github.com/LorenDB/lorendb.dev/blob/master/layouts/_default/rss.xml) if you want to use it in your own Hugo site. Visitors
from the future may wish to check out this [permalink](https://github.com/LorenDB/lorendb.dev/blob/d757e70b762843f2efc45ee4d7c01a263b004d17/layouts/_default/rss.xml) in case
I completely redo my template and you need the original for some reason.

## An update from the next day

The morning after I published this post, I noticed that Hugo is also truncating the contents of RSS feeds, so anybody using a feed reader on this blog would only see the first
paragraph or so of each post. This is an absolute crime in the realm of feed readers; it forces people to leave their feed reader for an external site to read the post. Being
lazy, I copied [somebody else's approach](https://www.godo.dev/tutorials/hugo-full-text-rss/) of telling Hugo to use the post `.Content` instead of the `.Summary`. However, I
also found out (the hard way) that you must keep the call to `transform.XMLEscape`; otherwise, your RSS feed will probably break when others try to add it to their feed readers.

I also realized that my original `<author>` implementation didn't meet RSS spec, so I modified it to come back in line with the spec.

## Update (2/24/2024)

I've realized from [this HN thread](https://news.ycombinator.com/item?id=39495285) that using `<dc:creator>` requires a modification to the `<rss>` element:

``` xml
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">
```

This will actually import the appropriate RSS namespace to provide `<dc:creator>`. Without this, some readers like Thunderbird would fail.

{{< chat fixing-hugos-rss-feed >}}
